[English](README.md) | [中文版](README_CN.md)

# 旅行助手

本项目是一个旅行助手，帮助用户规划行程，提供目的地信息、活动建议和旅行小贴士。它实现了一个多模态、可反馈、自动化的智能旅行规划助手，充分利用了大语言模型、流程编排、外部API集成和多轮人机交互等现代AI技术。

## 环境配置

- 在项目根目录下创建 `.env` 文件。
- 在 `.env` 文件中添加以下环境变量：
  - `OPENAI_API_KEY`
  - `OPENWEATHER_KEY`
  - `TAVILY_API_KEY`
  - `LANGCHAIN_API_KEY`
  - `LANGCHAIN_TRACING_V2`

## 技术栈与主要流程

### 技术栈
- **LangChain & LangGraph**：用于构建多节点、多阶段的对话与工作流，支持LLM调用、工具集成、状态管理与流程编排。
- **OpenAI GPT-4o**：作为主力大模型，负责生成旅行者角色、对话、摘要和最终旅行计划。
- **Pydantic**：用于定义和校验数据结构（如Traveler、Perspectives等）。
- **Requests**：用于调用外部API（如OpenWeather、OpenStreetMap）。
- **dotenv**：管理API密钥和环境变量。
- **Tavily Search API & WikipediaLoader**：实现网络检索和知识检索，辅助本地回答。
- **命令行交互**：通过Python标准输入输出与用户交互，收集反馈并展示结果。

### 工作流程
1. **环境变量与API密钥加载**：自动从`.env`文件加载API密钥，缺失时交互式补全。
2. **用户输入**：命令行输入目的地城市、天数、旅行者数量。
3. **天气信息获取**：通过OpenWeather API获取目的地多日天气，辅助后续行程规划。
4. **旅行者角色生成**：LLM根据城市、天气、天数和用户反馈生成多位旅行者persona。
5. **用户反馈**：用户可对生成的旅行者角色提出反馈，系统支持基于反馈重新生成角色。
6. **旅行者与本地人对话**：每位旅行者与“本地人”AI进行多轮对话，获取具体建议。
7. **检索增强**：对话中自动生成检索查询，调用Tavily或Wikipedia获取相关知识，辅助本地人回答。
8. **对话摘要**：LLM根据对话和检索内容生成结构化摘要（memo）。
9. **旅行计划整合**：LLM根据所有旅行者memo、天气和用户反馈，生成最终多天旅行计划，包含每日行程、预算（多币种）、注意事项和来源链接。
10. **交互式演示**：所有流程通过命令行逐步展示，用户可实时查看和反馈。

---

## Analysis

### Error Cases, Ablations, Limitations, Qualitative Insights

#### Error Cases
- **API Key 缺失或错误**：如OpenWeather、Tavily等API密钥未设置或无效，会导致天气或检索功能失效，返回错误信息。
- **外部API调用失败**：如网络不通、API限流、城市名无法解析等，天气或地理信息获取失败。
- **LLM输出结构不符**：如Persona生成、检索查询等结构化输出未按预期格式，可能导致后续流程中断。
- **用户输入异常**：如输入非法天数、旅行者数量等，系统会回退到默认值，但极端输入可能未完全覆盖。

#### Ablations
- **检索增强对比**：可通过关闭Tavily/Wikipedia检索，仅用LLM生成答案，比较计划的丰富性与准确性。
- **天气信息对比**：移除天气信息输入，观察行程推荐的适应性和合理性变化。
- **用户反馈作用**：不采纳用户反馈与采纳反馈的旅行者persona和最终计划对比，分析反馈机制对结果的影响。

#### Limitations
- **LLM幻觉与事实性**：尽管有检索增强，LLM仍可能生成不准确或虚构的内容，尤其在检索结果有限时。
- **预算估算粗略**：预算换算采用固定汇率，实际价格和汇率可能有较大波动。
- **多轮对话深度有限**：每位旅行者与本地人的对话轮数有限，可能无法覆盖所有细节。
- **计划可执行性**：生成的行程未必完全可落地，部分建议可能不适合所有用户或实际情况。

#### Qualitative Insights
- **计划可读性**：最终旅行计划结构清晰，包含每日天气、活动理由、预算和注意事项，适合快速浏览和参考。
- **响应适应性**：系统能根据天气、用户反馈和检索内容动态调整行程，体现一定的个性化和实用性。
- **用户参与感**：通过多轮反馈和交互，用户可深度参与旅行者persona和计划生成过程，提升体验。
- **多来源融合**：计划中引用多来源信息，并去重，提升内容权威性和丰富度。
